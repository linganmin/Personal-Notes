# 基础知识

## TCP/IP HTTP

TCP 是面向连接的通讯协议，简历会话过程如下：

- 请求一个面向连接的通信会话
- 建立会话
- 传输数据
- 传输结束，信道解除连接

### 三次握手，四次挥手

> TODO...

## 接口安全处理

### 并发

### 接口幂等

- 幂等概念
  - 保证唯一
- 产生原因
  - rpc 调用时网络延迟（重试发送请求）
  - 表单重复提交

幂等性是系统的接口对外的一种承诺，而不是实现。承诺只要调用接口成功，外部多次调用对系统的影响是一致的，声明为幂等的接口会认为外部调用失败是常态，并且失败之后必然会有重试。

有些接口是天然实现幂等性的，比如查询接口。对于查询接口，你查询一次和两次，对于系统来说没有任何影响，查出的结果是一样的。

#### 对增加、删除、更新操作做幂等处理

- 全局唯一 id

根据业务和操作的内容生成一个全局 id，在执行操作以先判断存储系统中是否存在这个全局 id 来判断这个操作是否已经执行。如果不存在则把全局 id，存到存储系统中，如果存在则表示该操作已经执行。

高可靠的幂等服务。

- 去重表

新建一张去重表（唯一键），在接口操作数据的事务中增加将唯一标识（比如订单 id）写入去重表，如果重复创建数据库会跑出唯一约束异常，操作就会回滚。

比如在支付场景中，如果一个订单只会支付一次，所以订单 ID 可以作为唯一标识。这时，我们就可以建一张去重表，并且把唯一标识作为唯一索引，在我们实现时，把创建支付单据和订单号写入去重表，放在一个事务中，如果重复创建，数据库会抛出唯一约束异常，操作就会回滚。

- 插入或更新

通过数据库唯一键，实现 createOrUpdate 操作

### 接口防刷

- 直接拒接访问
  - 验证码
    - 图像验证码
    - 滑块
    - 找不同
  - 设置接口请求频率百日每分钟 20 次，超过返回频繁操作
  - 对单个用户/IP 限制每分钟请求次数
  - 对敏感词/广告进行过滤
- 重放攻击
  - timestamp + 随机字符串
  - 前端请求带时间戳，和服务端对比，相差一分钟算作作弊
- 签名参数 sign 生成的方法
  - 第 1 步: 将所有参数（注意是所有参数），除去 sign 本身，以及值是空的参数，按参数名字母升序排序。
  - 第 2 步: 然后把排序后的参数按参数 1 值 1 参数 2 值 2…参数 n 值 n（这里的参数和值必须是传输参数的原始值，不能是经过处理的，如不能将&quot;转成”后再拼接）的方式拼接成一个字符串。
  - 第 3 步: 把分配给接入方的验证密钥 key 拼接在第 2 步得到的字符串前面。
  - 第 4 步: 计算第 3 步字符串的 md5 值(32 位)，然后转成大写,得到的字符串作为 sign 的值。
- 签名算法规则
  - 时间戳，随机数，口令按照首字母大小写顺序排序
  - 然后拼接成字符串
  - 进行 sha1 加密
  - 再进行 MD5 加密
  - 转换成大写。

## WEB 安全

### SQL 注入

#### 什么是 SQL 注入

通过把 sql 命令插入到 web 表单提交或输入域名或页面请求查询字符串，最终达到欺骗服务器执行恶意的 Sql 命令。

#### 怎么实现 SQL 注入

> TODO

#### 预防 SQL 注入

- 永远不要使用超级用户或所有者账号去连接数据库，严格限制账号权限。
- 检查输入的数据是否是所期望的数据格式或类型。
- 使用数据库特定的敏感字符转义函数，把用户提交的非数字数据进行转义
  - addslashes(),str_replace(),mysql_real_escape_string()
- 使用 PDO，预处理，绑定参数
  - prepare 语句后，绑定参数是和编译过的语句结合，而非 SQL 字符串结合。SQL 注入的原理就是混淆参数和语句
- 生产环境关闭 Debug 模式，避免将错误的 SQL 语句打印输出

### XSS 攻击（跨站脚本）

#### 怎么实现

> TODO

#### 避免

- 对任何用户输入的信息，入库前都进行转义
- 使用浏览器自带的 xss filter
- 使用 HttpOnly 保护 cookie

### CSRF(跨站请求伪造)

#### 怎么实现CSRF

> TODO

#### 避免策略

- 阻止不明外域访问
  - 同源检测
- 提交时要求附加本域才能获取的信息
  - csrf token

## Redis

- Redis 类型，使用场景

  Redis 支持更加丰富的数据存储类型，String、Hash、List、Set 和 Sorted Set。Memcached 仅支持简单的 key-value 结构。

  - String：key=>value set get decr incr
  - Hash: 存放结构化数据 hset hget hgetall
  - List: 消息队列、列表 lpush rpush lpop rpop lrange
  - Set: 不重复的无序集合，某些需要去重的列表 sadd spop smembers
  - Sorted Set 有序集合，比 set 多分数，根据分数自懂排序 zadd zrange zrem zcard

- Redis 如何实现持久化？

  - RDB 持久化，将 redis 在内存中的的状态保存到硬盘中，相当于备份数据库状态。

  - AOF 持久化（Append-Only-File），AOF 持久化是通过保存 Redis 服务器锁执行的写状态来记录数据库的。相当于备份数据库接收到的命令，所有被写入 AOF 的命令都是以 redis 的协议格式来保存的。

## 缓存

> TODO

## Linux

- 怎么查看各个 cpu 的资源占用情况？
  这个就是 top 命令进去之后按数字 1 了

- 如果进程 cpu 占用很高 ，一般是发生在那些部分

### Nginx 编译配置

> TODO

### PHP编译配置

> TODO